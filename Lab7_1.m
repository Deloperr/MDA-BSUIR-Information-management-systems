% СЛУЧАЙНЫЕ МНОГОМЕРНЫЕ МАТРИЦЫ
% (q=1, m=4)
clc; clear;

% 1. Задание возможных значений для каждой компоненты вектора
% x{i} - массив возможных значений i-й компоненты
x{1} = [0, 1]; % ξ1 может быть 0 или 1
x{2} = [0, 1]; % ξ2
x{3} = [0, 1]; % ξ3
x{4} = [0, 1]; % ξ4
k = [length(x{1}), length(x{2}), length(x{3}), length(x{4})]; % [2,2,2,2]

% 2. Задание матрицы вероятностей P (массив 2x2x2x2)
P = 0.04 * ones(2,2,2,2); % Сначала всем задаем 0.04
P(1,1,1,1) = 0.4; % Вектору (0,0,0,0) задаем вероятность 0.4
% Проверка нормировки
if abs(sum(P(:)) - 1) > 1e-10
    error('Сумма вероятностей не равна 1!');
end

% 3. Инициализация моментов
nu_1 = zeros(4, 1);    % Вектор для мат. ожидания (4x1)
nu_2 = zeros(4, 4);    % Матрица для E(ξ^2) (4x4)

% 4. Перебор всех возможных комбинаций значений
for i1 = 1:k(1)   % Индекс для ξ1
    for i2 = 1:k(2) % Индекс для ξ2
        for i3 = 1:k(3) % Индекс для ξ3
            for i4 = 1:k(4) % Индекс для ξ4
                % Формируем текущий вектор-значение
                y_vec = [x{1}(i1); x{2}(i2); x{3}(i3); x{4}(i4)];
                % Текущая вероятность
                p_val = P(i1, i2, i3, i4);
                
                % Расчет начального момента 1-го порядка
                nu_1 = nu_1 + y_vec * p_val;
                
                % Расчет начального момента 2-го порядка
                % (Внешнее произведение вектора на себя)
                nu_2 = nu_2 + (y_vec * y_vec') * p_val;
            end
        end
    end
end

% 5. Расчет ковариационной матрицы
mu_2 = nu_2 - (nu_1 * nu_1');

% 6. Вывод результатов
disp('Математическое ожидание E(ξ):');
disp(nu_1);
disp('Ковариационная матрица Cov(ξ,ξ):');
disp(mu_2);